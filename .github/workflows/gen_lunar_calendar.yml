name: Generate Lunar Calendar

on:
  # Автозапуск 28-го числа каждого месяца в 00:00 UTC
  schedule:
    - cron: '0 0 28 * *'
  # Кнопка «Run workflow» в UI
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: 🐍 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 📦 Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pendulum pyswisseph

      - name: 🚀 Generate lunar_calendar.json
        run: python gen_lunar_calendar.py

      - name: 📁 Upload lunar_calendar.json artifact
        # зашотили на конкретный SHA, чтобы избежать "Missing download info"
        uses: actions/upload-artifact@d64b8b3fb9d0a9f0c80fe69a0c4b21db3a7437bb
        with:
          name: lunar-calendar
          path: lunar_calendar.json
