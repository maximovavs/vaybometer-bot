#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
astro.py

â€¢ MOON_ICONS â€” 8-ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»ÑŒĞ½Ğ°Ñ Â«Ğ»ÑƒĞ½Ğ°-Ğ±Ğ°Ñ€Â».
â€¢ moon_phase()      â†’ ÑÑ‚Ñ€Ğ¾ĞºĞ° c Ñ„Ğ°Ğ·Ğ¾Ğ¹ Ğ›ÑƒĞ½Ñ‹ Ğ¸ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¾Ğ¼ Ğ·Ğ½Ğ°ĞºĞ°.
â€¢ upcoming_event()  â†’ Ğ°Ğ½Ğ¾Ğ½Ñ ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ â‰ˆ Ñ‡ĞµÑ€ĞµĞ· 3 Ğ´Ğ½Ñ.
â€¢ astro_events()    â†’ **Ñ€Ğ¾Ğ²Ğ½Ğ¾ Ğ´Ğ²Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸**:
      1. ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½ÑÑ Ñ„Ğ°Ğ·Ğ° Ğ›ÑƒĞ½Ñ‹;
      2. Â«â†’ â€¦Â» Ñ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ĞµĞ¼-Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸ĞµĞ¼.
"""

from __future__ import annotations
import math, datetime as dt
from typing import List, Optional
import swisseph as swe

# â”€â”€ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SIGNS = [
    "ĞĞ²Ğ½Ğµ", "Ğ¢ĞµĞ»ÑŒÑ†Ğµ", "Ğ‘Ğ»Ğ¸Ğ·Ğ½ĞµÑ†Ğ°Ñ…", "Ğ Ğ°ĞºĞµ", "Ğ›ÑŒĞ²Ğµ", "Ğ”ĞµĞ²Ğµ",
    "Ğ’ĞµÑĞ°Ñ…", "Ğ¡ĞºĞ¾Ñ€Ğ¿Ğ¸Ğ¾Ğ½Ğµ", "Ğ¡Ñ‚Ñ€ĞµĞ»ÑŒÑ†Ğµ", "ĞšĞ¾Ğ·ĞµÑ€Ğ¾Ğ³Ğµ", "Ğ’Ğ¾Ğ´Ğ¾Ğ»ĞµĞµ", "Ğ Ñ‹Ğ±Ğ°Ñ…",
]
EFFECT = [
    "Ğ¿Ñ€Ğ¸Ğ´Ğ°Ñ‘Ñ‚ Ñ€ĞµÑˆĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸", "Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚", "ÑƒÑĞ¸Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ»ÑĞ±Ğ¾Ğ·Ğ½Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ",
    "Ğ´ĞµĞ»Ğ°ĞµÑ‚ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½ĞµĞµ", "Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞ°Ğ¼Ğ¾Ğ¾Ñ†ĞµĞ½ĞºÑƒ", "ÑÑ‚Ğ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº",
    "Ğ¿Ñ€Ğ¾Ñ‰Ğ°ĞµÑ‚ Ğ¼ĞµĞ»Ğ¾Ñ‡Ğ¸", "ÑƒĞ³Ğ»ÑƒĞ±Ğ»ÑĞµÑ‚ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°", "Ñ‚Ğ¾Ğ»ĞºĞ°ĞµÑ‚ Ğº Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸ÑĞ¼",
    "Ñ„Ğ¾ĞºÑƒÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ° Ñ†ĞµĞ»ÑÑ…", "Ğ±ÑƒĞ´Ğ¸Ñ‚ Ğ¸Ğ´ĞµĞ¸", "Ğ·Ğ¾Ğ²Ñ‘Ñ‚ Ğº Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑĞ¼",
]

MOON_ICONS = "ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"

# â”€â”€ Ñ„Ğ°Ğ·Ğ° Ğ›ÑƒĞ½Ñ‹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def moon_phase() -> str:
    now = dt.datetime.utcnow()
    jd  = swe.julday(now.year, now.month, now.day)
    sun_lon,  *_ = swe.calc_ut(jd, swe.SUN)[0]
    moon_lon, *_ = swe.calc_ut(jd, swe.MOON)[0]

    phase  = ((moon_lon - sun_lon + 360) % 360) / 360   # 0â€¦1
    illum  = round(abs(math.cos(math.pi * phase)) * 100)
    icon   = MOON_ICONS[int(phase * 8) % 8]

    if illum < 5:
        name = "ĞĞ¾Ğ²Ğ¾Ğ»ÑƒĞ½Ğ¸Ğµ"
    elif illum > 95:
        name = "ĞŸĞ¾Ğ»Ğ½Ğ¾Ğ»ÑƒĞ½Ğ¸Ğµ"
    elif phase < 0.5:
        name = "Ğ Ğ°ÑÑ‚ÑƒÑ‰Ğ°Ñ Ğ›ÑƒĞ½Ğ°"
    else:
        name = "Ğ£Ğ±Ñ‹Ğ²Ğ°ÑÑ‰Ğ°Ñ Ğ›ÑƒĞ½Ğ°"

    sign = SIGNS[int(moon_lon // 30) % 12]
    eff  = EFFECT[int(moon_lon // 30) % 12]

    return f"{icon} {name} Ğ² {sign} ({illum}% Ğ¾ÑĞ²ĞµÑ‰.) â€” {eff}"

# â”€â”€ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Â«Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹Â» Ğ°ÑÑ‚Ñ€Ğ¾ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def upcoming_event(days: int = 3) -> Optional[str]:
    """
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ Ğ°Ğ½Ğ¾Ğ½Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `days` ÑÑƒÑ‚Ğ¾Ğº.
    ĞŸĞ¾-ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ·Ğ°Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ; Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
    Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ API / Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹.
    """
    if days == 3:
        return "Ğ§ĞµÑ€ĞµĞ· 3 Ğ´Ğ½Ñ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ»Ğ½ĞµÑ‡Ğ½Ğ¾Ğµ Ğ·Ğ°Ñ‚Ğ¼ĞµĞ½Ğ¸Ğµ â€” ÑƒÑĞ¸Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ÑƒĞ¸Ñ†Ğ¸Ğ¸"
    return None

# â”€â”€ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ post.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def astro_events() -> List[str]:
    """
    â–¸ [0] ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½ÑÑ Ñ„Ğ°Ğ·Ğ° Ğ›ÑƒĞ½Ñ‹
    â–¸ [1] Â«â†’ â€¦Â» Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¹ Ğ°Ğ½Ğ¾Ğ½Ñ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    """
    events = [moon_phase()]
    if ann := upcoming_event():
        events.append(f"â†’ {ann}")
    return events


# â”€â”€ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº:  python -m astro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    from pprint import pprint
    pprint(astro_events())
